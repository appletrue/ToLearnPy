# Python数据分析模块 :Pandas

Pandas是为了解决数据分析任务而创建的，纳入了大量的库和标准数据模型，提供了高效地操作大型数据集所需的工具。

一般需要引入的包：
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt    #python的2D绘图库
```

## pandas中的数据结构 :

为了开始使用pandas，你需要熟悉它的两个重要的数据结构： Series 和 DataFrame.

- Series: 是一个一维的数组对象，包含一个数组的数据（任何NumPy的数据类型）和一个与数组关联的数据标签，被叫做 索引。
    -  类似于python中的基本数据结构list，区别是series只允许存储相同的数据类型，这样可以更有效的使用内存，提高运算效率。就像数据库中的列数据。
    
    -  我们没有给数据指定索引，一个包含整数0到 N-1 （这里N是数据的长度）的默认索引被创建。
    
    -  NumPy数组操作，例如通过一个布尔数组过滤，纯量乘法，或使用数学函数，将会保持索引和值间的关联。
    
    - Series的索引可以通过赋值就地更改。
    
    - 如果你有一些数据在一个Python字典中，你可以通过传递字典来从这些数据创建一个Series，只传递一个字典的时候，结果Series中的索引将是排序后的字典的键。
    
    -  如果你有一些数据在一个Python字典中，你可以通过传递字典来从这些数据创建一个Series，只传递一个字典的时候，结果Series中的索引将是排序后的字典的键。
  
- DataFrame: 二维的表格型数据结构。包含一个经过排序的列表集，它们每一个都可以有不同的类型值（数字，字符串，布尔等等）。很多功能与R中的data.frame类似。可以将DataFrame理解为Series的容器。
    -  Datarame有行和列的索引；它可以被看作是一个Series的字典（每个Series共享一个索引），产生的DataFrame和Series一样，它的索引会自动分配，并且对列进行了排序。
    -  在底层，数据是作为一个或多个二维数组存储的，而不是列表，字典，或其它一维的数组集合。
    -  可以采用分层索引以表格格式来表示高维的数据。
    -  索引DataFrame时返回的列是底层数据的一个视窗，而不是一个拷贝。因此，任何在Series上的就地修改都会影响DataFrame。列可以使用Series的 copy 函数来显式的拷贝。

- Panel：三维的数组，可以理解为DataFrame的容器。

可能的传递到DataFrame的构造器

|构造器|说明|
|----|----|
|二维ndarray	        |一个数据矩阵，有可选的行标和列标 |
|数组，列表或元组的字典  |每一个序列成为DataFrame中的一列。所有的序列必须有相同的长度 |
|NumPy的结构/记录数组	 |和“数组字典”一样处理|
|Series的字典	        |每一个值成为一列。如果没有明显的传递索引，将结合每一个Series的索引来形成结果的行索引。|
|字典的字典	          |每一个内部的字典成为一列。和“Series的字典”一样，结合键值来形成行索引。|
|字典或Series的列表     |每一项成为DataFrame中的一列。结合字典键或Series索引形成DataFrame的列标|
|列表或元组的列表	      |和“二维ndarray”一样处理|
|另一个DataFrame	      |DataFrame的索引将被使用，除非传递另外一个|
|NumPy伪装数组（MaskedArray）|	除了蒙蔽值在DataFrame中成为NA/丢失数据之外，其它的和“二维ndarray”一样|

## 创建对象：

### 通过传入一个列表来创建 Series ，pandas会创建默认的整形指标:

```python
import pandas as pd
import numpy as np
#import matplotlib.pyplot as plt

s = pd.Series([1,3,5,np.nan,6,8])
print(s)
#输出结果：
0    1.0
1    3.0
2    5.0
3    NaN
4    6.0
5    8.0
dtype: float64
```
### 通过传递数字数组、时间索引、列标签来创建 DataFrame

```python
import pandas as pd
import numpy as np

dates = pd.date_range('20130101',periods=6)
print(dates)
#输出结果：
DatetimeIndex(['2013-01-01', '2013-01-02', '2013-01-03', '2013-01-04',
               '2013-01-05', '2013-01-06'],
              dtype='datetime64[ns]', freq='D')
df = pd.DataFrame(np.random.randn(6,4),index=dates,columns=list('ABCD'))  #np.random.randn(6,4) 即创建6行4列的随机数字数组
print(df)
#输出结果：
                   A         B         C         D
2013-01-01  0.430047 -1.197117  0.479633  0.486987
2013-01-02  0.078111 -0.544463  0.109476 -0.174031
2013-01-03 -0.129429  0.219026  2.677468 -1.305857
2013-01-04  0.031767 -0.518632  0.586993 -0.041194
2013-01-05  0.031605  0.362046  0.033285 -0.653184
2013-01-06  0.589679  0.675416  2.200462  1.484775
```

### 通过传递能被转换成类似结构的字典来创建DataFrame:

```python
import pandas as pd
import numpy as np


df2 = pd.DataFrame({'A': 1.,
                    'B': pd.Timestamp('20130102'),
                    'C': pd.Series(1, index=list(range(4)), dtype='float32'),
                    'D': np.array([3] * 4, dtype='int32'),
                    'E': pd.Categorical(["test", "train", "test", "train"]),
                    'F': 'foo'})
print(df2)
#输出结果：
     A          B    C  D      E    F
0  1.0 2013-01-02  1.0  3   test  foo
1  1.0 2013-01-02  1.0  3  train  foo
2  1.0 2013-01-02  1.0  3   test  foo
3  1.0 2013-01-02  1.0  3  train  foo

print(df2.dtypes)     #查看各列的 dtypes
#输出结果：
A           float64
B    datetime64[ns]
C           float32
D             int32
E          category
F            object
dtype: object
```
## 查看数据

### 查看DataFrame头部&尾部数据:
```python
print(df2.head())
#输出结果：
     A          B    C  D      E    F
0  1.0 2013-01-02  1.0  3   test  foo
1  1.0 2013-01-02  1.0  3  train  foo
2  1.0 2013-01-02  1.0  3   test  foo
3  1.0 2013-01-02  1.0  3  train  foo

print(df2.tail(2))
#输出结果：
2  1.0 2013-01-02  1.0  3   test  foo
3  1.0 2013-01-02  1.0  3  train  foo
```

### 查看索引、列、和数组数据:

```python
print(df2.index)
print(df2.columns)
print(df2.values)
#输出结果：
Int64Index([0, 1, 2, 3], dtype='int64')
Index(['A', 'B', 'C', 'D', 'E', 'F'], dtype='object')
[[1.0 Timestamp('2013-01-02 00:00:00') 1.0 3 'test' 'foo']
 [1.0 Timestamp('2013-01-02 00:00:00') 1.0 3 'train' 'foo']
 [1.0 Timestamp('2013-01-02 00:00:00') 1.0 3 'test' 'foo']
 [1.0 Timestamp('2013-01-02 00:00:00') 1.0 3 'train' 'foo']]
```

### 查看数据的快速统计结果:

```python
print(df.describe())
                  A         B         C         D
    count  6.000000  6.000000  6.000000  6.000000
    mean  -0.477614  0.037671 -0.198127  0.862672
    std    0.945047  0.643196  0.736736  0.685969
    min   -1.903683 -0.545903 -1.376442  0.177973
    25%   -0.871078 -0.462082 -0.551460  0.252739
    50%   -0.509775 -0.203747 -0.090866  0.809282
    75%    0.014637  0.587258  0.306658  1.415466
    max    0.859619  0.876693  0.635237  1.694740
```

### 对数据进行行列转换:

```python
print(df.T)

       2013-01-01  2013-01-02  2013-01-03  2013-01-04  2013-01-05  2013-01-06
    A    0.859619    0.119622   -0.719234   -0.921692   -0.300317   -1.903683
    B   -0.545903   -0.484051   -0.396174    0.876693   -0.011320    0.786785
    C    0.012447    0.404728    0.635237   -0.670553   -1.376442   -0.194179
    D    1.257684    0.360880    0.216691    1.468060    1.694740    0.177973
```

### 按 axis 排序:

```python
df.sort_index(axis=1, ascending=False)
                       D         C         B         A
    2013-01-01  1.257684  0.012447 -0.545903  0.859619
    2013-01-02  0.360880  0.404728 -0.484051  0.119622
    2013-01-03  0.216691  0.635237 -0.396174 -0.719234
    2013-01-04  1.468060 -0.670553  0.876693 -0.921692
    2013-01-05  1.694740 -1.376442 -0.011320 -0.300317
    2013-01-06  0.177973 -0.194179  0.786785 -1.903683
```
6.按值排序:

```python
df.sort_values(by='B')
                       A         B         C         D
    2013-01-01  0.859619 -0.545903  0.012447  1.257684
    2013-01-02  0.119622 -0.484051  0.404728  0.360880
    2013-01-03 -0.719234 -0.396174  0.635237  0.216691
    2013-01-05 -0.300317 -0.011320 -1.376442  1.694740
    2013-01-06 -1.903683  0.786785 -0.194179  0.177973
    2013-01-04 -0.921692  0.876693 -0.670553  1.468060
```
